<!DOCTYPE html>
<html>
<body style="margin:0; background:black; overflow:hidden;">
    <video id="v" autoplay playsinline style="position:fixed; width:100vw; height:100vh; object-fit:cover;"></video>
    
    <canvas id="c" style="position:fixed; width:100vw; height:100vh; object-fit:cover; pointer-events:none;"></canvas>

    <script>
        const v = document.getElementById('v');
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');

        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(s => { v.srcObject = s; });

        function render() {
            if (v.videoWidth > 0) {
                // Lower resolution for the mask to make the blur "thicker"
                c.width = v.videoWidth / 5; 
                c.height = v.videoHeight / 5;
                ctx.clearRect(0, 0, c.width, c.height);
                
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = c.width;
                tempCanvas.height = c.height;
                const tempCtx = tempCanvas.getContext('2d');
                tempCtx.drawImage(v, 0, 0, c.width, c.height);
                
                let f = tempCtx.getImageData(0, 0, c.width, c.height);
                let d = f.data;
                let orangeFound = 0;

                for (let i = 0; i < d.length; i += 4) {
                    let r = d[i], g = d[i+1], b = d[i+2];
                    
                    // MASK LOGIC: Is this pixel "Orange"?
                    // Orange has high Red, medium Green, and very low Blue.
                    if (r > 130 && g > 60 && g < r && b < (r + g) / 4) {
                        orangeFound++;
                        // If orange, make this part of the mask a solid blurry color
                        d[i] = r; d[i+1] = g; d[i+2] = b; 
                        d[i+3] = 255; // Solid
                    } else {
                        // If NOT orange, make this part of the mask 100% GHOST (Transparent)
                        d[i+3] = 0; 
                    }
                }

                // COMPLETE BOX CHECK: 
                // Only "wear" the mask if enough orange is visible to form a box.
                if (orangeFound > 250) {
                    ctx.putImageData(f, 0, 0);
                    // This blurs the MASK only, not the camera.
                    ctx.filter = "blur(12px)";
                    ctx.drawImage(c, 0, 0); 
                    c.style.filter = "blur(25px)";
                } else {
                    ctx.clearRect(0, 0, c.width, c.height);
                }
            }
            requestAnimationFrame(render);
        }
        v.onplay = () => render();
    </script>
</body>
</html>
