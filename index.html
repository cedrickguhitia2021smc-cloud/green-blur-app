<!DOCTYPE html>
<html>
<body style="margin:0; background:black; overflow:hidden;">
    <video id="v" autoplay playsinline style="position:fixed; width:100vw; height:100vh; object-fit:cover;"></video>
    <canvas id="c" style="position:fixed; width:100vw; height:100vh; object-fit:cover; pointer-events:none;"></canvas>

    <script>
        const v = document.getElementById('v');
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');

        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(s => { v.srcObject = s; });

        function render() {
            if (v.videoWidth > 0) {
                const w = v.videoWidth / 4;
                const h = v.videoHeight / 4;
                c.width = w; c.height = h;

                // 1. Draw the current frame to a hidden workspace
                const temp = document.createElement('canvas');
                temp.width = w; temp.height = h;
                const tCtx = temp.getContext('2d');
                tCtx.drawImage(v, 0, 0, w, h);

                let f = tCtx.getImageData(0, 0, w, h);
                let d = f.data;
                let orangeFound = 0;

                // 2. Identify Orange pixels for the Mask
                for (let i = 0; i < d.length; i += 4) {
                    let r = d[i], g = d[i+1], b = d[i+2];
                    // Strict Orange: Red is dominant, Green is medium, Blue is very low
                    if (r > 120 && g > 50 && r > g * 1.5 && b < 100) {
                        orangeFound++;
                        d[i+3] = 255; // Keep pixel for mask
                    } else {
                        d[i+3] = 0;   // Erase pixel from mask
                    }
                }

                // 3. Logic: Only apply mask if box is complete (enough orange pixels)
                if (orangeFound > 200) {
                    // Put the mask data onto the main canvas
                    ctx.putImageData(f, 0, 0);
                    
                    // The "Magic" Masking Step:
                    // We tell the canvas to only show color where our mask is solid
                    ctx.globalCompositeOperation = 'source-in';
                    ctx.drawImage(v, 0, 0, w, h);
                    
                    // Apply blur to the stencil only
                    c.style.filter = "blur(20px) saturate(200%)";
                    c.style.transform = "scale(1.1)"; // Expand mask slightly to cover edges
                } else {
                    ctx.clearRect(0, 0, w, h);
                }
            }
            requestAnimationFrame(render);
        }
        v.onplay = () => render();
    </script>
</body>
</html>
